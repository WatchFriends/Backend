function Socket(t,e,s){this.nsp=t,this.server=t.server,this.adapter=this.nsp.adapter,this.id="/"!==t.name?t.name+"#"+e.id:e.id,this.client=e,this.conn=e.conn,this.rooms={},this.acks={},this.connected=!0,this.disconnected=!1,this.handshake=this.buildHandshake(s),this.fns=[]}var socket=io(),Emitter=require("events").EventEmitter,parser=require("socket.io-parser"),url=require("url"),debug=require("debug")("socket.io:socket"),hasBin=require("has-binary"),assign=require("object-assign");module.exports=exports=Socket,exports.events=["error","connect","disconnect","disconnecting","newListener","removeListener"];var flags=["json","volatile","broadcast"],emit=Emitter.prototype.emit;Socket.prototype.__proto__=Emitter.prototype,flags.forEach(function(t){Socket.prototype.__defineGetter__(t,function(){return this.flags=this.flags||{},this.flags[t]=!0,this})}),Socket.prototype.__defineGetter__("request",function(){return this.conn.request}),Socket.prototype.buildHandshake=function(t){function e(){var e=url.parse(s.request.url,!0).query;return assign({},t,e)}var s=this;return{headers:this.request.headers,time:new Date+"",address:this.conn.remoteAddress,xdomain:!!this.request.headers.origin,secure:!!this.request.connection.encrypted,issued:+new Date,url:this.request.url,query:e()}},Socket.prototype.emit=function(t){if(~exports.events.indexOf(t))emit.apply(this,arguments);else{var e=Array.prototype.slice.call(arguments),s={};s.type=hasBin(e)?parser.BINARY_EVENT:parser.EVENT,s.data=e;var o=this.flags||{};if("function"==typeof e[e.length-1]){if(this._rooms||o.broadcast)throw new Error("Callbacks are not supported when broadcasting");debug("emitting packet with ack id %d",this.nsp.ids),this.acks[this.nsp.ids]=e.pop(),s.id=this.nsp.ids++}this._rooms||o.broadcast?this.adapter.broadcast(s,{except:[this.id],rooms:this._rooms,flags:o}):this.packet(s,{volatile:o.volatile,compress:o.compress}),delete this._rooms,delete this.flags}return this},Socket.prototype.to=Socket.prototype.in=function(t){return this._rooms=this._rooms||[],~this._rooms.indexOf(t)||this._rooms.push(t),this},Socket.prototype.send=Socket.prototype.write=function(){var t=Array.prototype.slice.call(arguments);return t.unshift("message"),this.emit.apply(this,t),this},Socket.prototype.packet=function(t,e){t.nsp=this.nsp.name,e=e||{},e.compress=!1!==e.compress,this.client.packet(t,e)},Socket.prototype.join=function(t,e){debug("joining room %s",t);var s=this;return this.rooms.hasOwnProperty(t)?(e&&e(null),this):(this.adapter.add(this.id,t,function(o){return o?e&&e(o):(debug("joined room %s",t),s.rooms[t]=t,void(e&&e(null)))}),this)},Socket.prototype.leave=function(t,e){debug("leave room %s",t);var s=this;return this.adapter.del(this.id,t,function(o){return o?e&&e(o):(debug("left room %s",t),delete s.rooms[t],void(e&&e(null)))}),this},Socket.prototype.leaveAll=function(){this.adapter.delAll(this.id),this.rooms={}},Socket.prototype.onconnect=function(){debug("socket connected - writing packet"),this.nsp.connected[this.id]=this,this.join(this.id),this.packet({type:parser.CONNECT})},Socket.prototype.onpacket=function(t){switch(debug("got packet %j",t),t.type){case parser.EVENT:this.onevent(t);break;case parser.BINARY_EVENT:this.onevent(t);break;case parser.ACK:this.onack(t);break;case parser.BINARY_ACK:this.onack(t);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",t.data)}},Socket.prototype.onevent=function(t){var e=t.data||[];debug("emitting event %j",e),null!=t.id&&(debug("attaching ack callback to event"),e.push(this.ack(t.id))),this.dispatch(e)},Socket.prototype.ack=function(t){var e=this,s=!1;return function(){if(!s){var o=Array.prototype.slice.call(arguments);debug("sending ack %j",o);var i=hasBin(o)?parser.BINARY_ACK:parser.ACK;e.packet({id:t,type:i,data:o}),s=!0}}},Socket.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(debug("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):debug("bad ack %s",t.id)},Socket.prototype.ondisconnect=function(){debug("got disconnect packet"),this.onclose("client namespace disconnect")},Socket.prototype.onerror=function(t){this.listeners("error").length?this.emit("error",t):(console.error("Missing error handler on `socket`."),console.error(t.stack))},Socket.prototype.onclose=function(t){return this.connected?(debug("closing socket - reason %s",t),this.emit("disconnecting",t),this.leaveAll(),this.nsp.remove(this),this.client.remove(this),this.connected=!1,this.disconnected=!0,delete this.nsp.connected[this.id],void this.emit("disconnect",t)):this},Socket.prototype.error=function(t){this.packet({type:parser.ERROR,data:t})},Socket.prototype.disconnect=function(t){return this.connected?(t?this.client.disconnect():(this.packet({type:parser.DISCONNECT}),this.onclose("server namespace disconnect")),this):this},Socket.prototype.compress=function(t){return this.flags=this.flags||{},this.flags.compress=t,this},Socket.prototype.dispatch=function(t){debug("dispatching an event %j",t);var e=this;this.run(t,function(s){process.nextTick(function(){return s?e.emit("error",s.data||s.message):void emit.apply(e,t)})})},Socket.prototype.use=function(t){return this.fns.push(t),this},Socket.prototype.run=function(t,e){function s(i){o[i](t,function(t){return t?e(t):o[i+1]?void s(i+1):e(null)})}var o=this.fns.slice(0);return o.length?void s(0):e(null)};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvY2tldC5qcyIsInNpdGUuanMiXSwibmFtZXMiOlsiU29ja2V0IiwibnNwIiwiY2xpZW50IiwicXVlcnkiLCJ0aGlzIiwic2VydmVyIiwiYWRhcHRlciIsImlkIiwibmFtZSIsImNvbm4iLCJyb29tcyIsImFja3MiLCJjb25uZWN0ZWQiLCJkaXNjb25uZWN0ZWQiLCJoYW5kc2hha2UiLCJidWlsZEhhbmRzaGFrZSIsImZucyIsInNvY2tldCIsImlvIiwiRW1pdHRlciIsInJlcXVpcmUiLCJFdmVudEVtaXR0ZXIiLCJwYXJzZXIiLCJ1cmwiLCJkZWJ1ZyIsImhhc0JpbiIsImFzc2lnbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJldmVudHMiLCJmbGFncyIsImVtaXQiLCJwcm90b3R5cGUiLCJfX3Byb3RvX18iLCJmb3JFYWNoIiwiZmxhZyIsIl9fZGVmaW5lR2V0dGVyX18iLCJyZXF1ZXN0IiwiYnVpbGRRdWVyeSIsInJlcXVlc3RRdWVyeSIsInBhcnNlIiwic2VsZiIsImhlYWRlcnMiLCJ0aW1lIiwiRGF0ZSIsImFkZHJlc3MiLCJyZW1vdGVBZGRyZXNzIiwieGRvbWFpbiIsIm9yaWdpbiIsInNlY3VyZSIsImNvbm5lY3Rpb24iLCJlbmNyeXB0ZWQiLCJpc3N1ZWQiLCJldiIsImluZGV4T2YiLCJhcHBseSIsImFyZ3VtZW50cyIsImFyZ3MiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsInBhY2tldCIsInR5cGUiLCJCSU5BUllfRVZFTlQiLCJFVkVOVCIsImRhdGEiLCJsZW5ndGgiLCJfcm9vbXMiLCJicm9hZGNhc3QiLCJFcnJvciIsImlkcyIsInBvcCIsImV4Y2VwdCIsInZvbGF0aWxlIiwiY29tcHJlc3MiLCJ0byIsImluIiwicHVzaCIsInNlbmQiLCJ3cml0ZSIsInVuc2hpZnQiLCJvcHRzIiwiam9pbiIsInJvb20iLCJmbiIsImhhc093blByb3BlcnR5IiwiYWRkIiwiZXJyIiwibGVhdmUiLCJkZWwiLCJsZWF2ZUFsbCIsImRlbEFsbCIsIm9uY29ubmVjdCIsIkNPTk5FQ1QiLCJvbnBhY2tldCIsIm9uZXZlbnQiLCJBQ0siLCJvbmFjayIsIkJJTkFSWV9BQ0siLCJESVNDT05ORUNUIiwib25kaXNjb25uZWN0IiwiRVJST1IiLCJhY2siLCJkaXNwYXRjaCIsInNlbnQiLCJvbmNsb3NlIiwib25lcnJvciIsImxpc3RlbmVycyIsImNvbnNvbGUiLCJlcnJvciIsInN0YWNrIiwicmVhc29uIiwicmVtb3ZlIiwiZGlzY29ubmVjdCIsImNsb3NlIiwiZXZlbnQiLCJydW4iLCJwcm9jZXNzIiwibmV4dFRpY2siLCJtZXNzYWdlIiwidXNlIiwiaSJdLCJtYXBwaW5ncyI6IkFBMkRBLFFBQUFBLFFBQUFDLEVBQUFDLEVBQUFDLEdBQ0FDLEtBQUFILElBQUFBLEVBQ0FHLEtBQUFDLE9BQUFKLEVBQUFJLE9BQ0FELEtBQUFFLFFBQUFGLEtBQUFILElBQUFLLFFBQ0FGLEtBQUFHLEdBQUEsTUFBQU4sRUFBQU8sS0FBQVAsRUFBQU8sS0FBQSxJQUFBTixFQUFBSyxHQUFBTCxFQUFBSyxHQUNBSCxLQUFBRixPQUFBQSxFQUNBRSxLQUFBSyxLQUFBUCxFQUFBTyxLQUNBTCxLQUFBTSxTQUNBTixLQUFBTyxRQUNBUCxLQUFBUSxXQUFBLEVBQ0FSLEtBQUFTLGNBQUEsRUFDQVQsS0FBQVUsVUFBQVYsS0FBQVcsZUFBQVosR0FDQUMsS0FBQVksT0N2RUEsR0FBQUMsUUFBQUMsS0RLQUMsUUFBQUMsUUFBQSxVQUFBQyxhQUNBQyxPQUFBRixRQUFBLG9CQUNBRyxJQUFBSCxRQUFBLE9BQ0FJLE1BQUFKLFFBQUEsU0FBQSxvQkFDQUssT0FBQUwsUUFBQSxjQUNBTSxPQUFBTixRQUFBLGdCQU1BTyxRQUFBQyxRQUFBQSxRQUFBNUIsT0FRQTRCLFFBQUFDLFFBQ0EsUUFDQSxVQUNBLGFBQ0EsZ0JBQ0EsY0FDQSxpQkFTQSxJQUFBQyxRQUNBLE9BQ0EsV0FDQSxhQU9BQyxLQUFBWixRQUFBYSxVQUFBRCxJQTZCQS9CLFFBQUFnQyxVQUFBQyxVQUFBZCxRQUFBYSxVQU1BRixNQUFBSSxR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QXJDLEVBQUEsUUFUQSxHQUFBcEUsR0FBQVosS0FBQVksSUFBQTJDLE1BQUEsRUFDQSxPQUFBM0MsR0FBQWtELFdBZUFrRCxHQUFBLEdBZkFoQyxFQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuLyoqXHJcbiAqIE1vZHVsZSBkZXBlbmRlbmNpZXMuXHJcbiAqL1xyXG5cclxudmFyIEVtaXR0ZXIgPSByZXF1aXJlKCdldmVudHMnKS5FdmVudEVtaXR0ZXI7XHJcbnZhciBwYXJzZXIgPSByZXF1aXJlKCdzb2NrZXQuaW8tcGFyc2VyJyk7XHJcbnZhciB1cmwgPSByZXF1aXJlKCd1cmwnKTtcclxudmFyIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKSgnc29ja2V0LmlvOnNvY2tldCcpO1xyXG52YXIgaGFzQmluID0gcmVxdWlyZSgnaGFzLWJpbmFyeScpO1xyXG52YXIgYXNzaWduID0gcmVxdWlyZSgnb2JqZWN0LWFzc2lnbicpO1xyXG5cclxuLyoqXHJcbiAqIE1vZHVsZSBleHBvcnRzLlxyXG4gKi9cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IFNvY2tldDtcclxuXHJcbi8qKlxyXG4gKiBCbGFja2xpc3RlZCBldmVudHMuXHJcbiAqXHJcbiAqIEBhcGkgcHVibGljXHJcbiAqL1xyXG5cclxuZXhwb3J0cy5ldmVudHMgPSBbXHJcbiAgJ2Vycm9yJyxcclxuICAnY29ubmVjdCcsXHJcbiAgJ2Rpc2Nvbm5lY3QnLFxyXG4gICdkaXNjb25uZWN0aW5nJyxcclxuICAnbmV3TGlzdGVuZXInLFxyXG4gICdyZW1vdmVMaXN0ZW5lcidcclxuXTtcclxuXHJcbi8qKlxyXG4gKiBGbGFncy5cclxuICpcclxuICogQGFwaSBwcml2YXRlXHJcbiAqL1xyXG5cclxudmFyIGZsYWdzID0gW1xyXG4gICdqc29uJyxcclxuICAndm9sYXRpbGUnLFxyXG4gICdicm9hZGNhc3QnXHJcbl07XHJcblxyXG4vKipcclxuICogYEV2ZW50RW1pdHRlciNlbWl0YCByZWZlcmVuY2UuXHJcbiAqL1xyXG5cclxudmFyIGVtaXQgPSBFbWl0dGVyLnByb3RvdHlwZS5lbWl0O1xyXG5cclxuLyoqXHJcbiAqIEludGVyZmFjZSB0byBhIGBDbGllbnRgIGZvciBhIGdpdmVuIGBOYW1lc3BhY2VgLlxyXG4gKlxyXG4gKiBAcGFyYW0ge05hbWVzcGFjZX0gbnNwXHJcbiAqIEBwYXJhbSB7Q2xpZW50fSBjbGllbnRcclxuICogQGFwaSBwdWJsaWNcclxuICovXHJcblxyXG5mdW5jdGlvbiBTb2NrZXQobnNwLCBjbGllbnQsIHF1ZXJ5KXtcclxuICB0aGlzLm5zcCA9IG5zcDtcclxuICB0aGlzLnNlcnZlciA9IG5zcC5zZXJ2ZXI7XHJcbiAgdGhpcy5hZGFwdGVyID0gdGhpcy5uc3AuYWRhcHRlcjtcclxuICB0aGlzLmlkID0gbnNwLm5hbWUgIT09ICcvJyA/IG5zcC5uYW1lICsgJyMnICsgY2xpZW50LmlkIDogY2xpZW50LmlkO1xyXG4gIHRoaXMuY2xpZW50ID0gY2xpZW50O1xyXG4gIHRoaXMuY29ubiA9IGNsaWVudC5jb25uO1xyXG4gIHRoaXMucm9vbXMgPSB7fTtcclxuICB0aGlzLmFja3MgPSB7fTtcclxuICB0aGlzLmNvbm5lY3RlZCA9IHRydWU7XHJcbiAgdGhpcy5kaXNjb25uZWN0ZWQgPSBmYWxzZTtcclxuICB0aGlzLmhhbmRzaGFrZSA9IHRoaXMuYnVpbGRIYW5kc2hha2UocXVlcnkpO1xyXG4gIHRoaXMuZm5zID0gW107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbmhlcml0cyBmcm9tIGBFdmVudEVtaXR0ZXJgLlxyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUuX19wcm90b19fID0gRW1pdHRlci5wcm90b3R5cGU7XHJcblxyXG4vKipcclxuICogQXBwbHkgZmxhZ3MgZnJvbSBgU29ja2V0YC5cclxuICovXHJcblxyXG5mbGFncy5mb3JFYWNoKGZ1bmN0aW9uKGZsYWcpe1xyXG4gIFNvY2tldC5wcm90b3R5cGUuX19kZWZpbmVHZXR0ZXJfXyhmbGFnLCBmdW5jdGlvbigpe1xyXG4gICAgdGhpcy5mbGFncyA9IHRoaXMuZmxhZ3MgfHwge307XHJcbiAgICB0aGlzLmZsYWdzW2ZsYWddID0gdHJ1ZTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH0pO1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBgcmVxdWVzdGAgZW5naW5lLmlvIHNob3J0Y3V0LlxyXG4gKlxyXG4gKiBAYXBpIHB1YmxpY1xyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUuX19kZWZpbmVHZXR0ZXJfXygncmVxdWVzdCcsIGZ1bmN0aW9uKCl7XHJcbiAgcmV0dXJuIHRoaXMuY29ubi5yZXF1ZXN0O1xyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBCdWlsZHMgdGhlIGBoYW5kc2hha2VgIEJDIG9iamVjdFxyXG4gKlxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLmJ1aWxkSGFuZHNoYWtlID0gZnVuY3Rpb24ocXVlcnkpe1xyXG4gIHZhciBzZWxmID0gdGhpcztcclxuICBmdW5jdGlvbiBidWlsZFF1ZXJ5KCl7XHJcbiAgICB2YXIgcmVxdWVzdFF1ZXJ5ID0gdXJsLnBhcnNlKHNlbGYucmVxdWVzdC51cmwsIHRydWUpLnF1ZXJ5O1xyXG4gICAgLy9pZiBzb2NrZXQtc3BlY2lmaWMgcXVlcnkgZXhpc3QsIHJlcGxhY2UgcXVlcnkgc3RyaW5ncyBpbiByZXF1ZXN0UXVlcnlcclxuICAgIHJldHVybiBhc3NpZ24oe30sIHF1ZXJ5LCByZXF1ZXN0UXVlcnkpO1xyXG4gIH1cclxuICByZXR1cm4ge1xyXG4gICAgaGVhZGVyczogdGhpcy5yZXF1ZXN0LmhlYWRlcnMsXHJcbiAgICB0aW1lOiAobmV3IERhdGUpICsgJycsXHJcbiAgICBhZGRyZXNzOiB0aGlzLmNvbm4ucmVtb3RlQWRkcmVzcyxcclxuICAgIHhkb21haW46ICEhdGhpcy5yZXF1ZXN0LmhlYWRlcnMub3JpZ2luLFxyXG4gICAgc2VjdXJlOiAhIXRoaXMucmVxdWVzdC5jb25uZWN0aW9uLmVuY3J5cHRlZCxcclxuICAgIGlzc3VlZDogKyhuZXcgRGF0ZSksXHJcbiAgICB1cmw6IHRoaXMucmVxdWVzdC51cmwsXHJcbiAgICBxdWVyeTogYnVpbGRRdWVyeSgpXHJcbiAgfTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBFbWl0cyB0byB0aGlzIGNsaWVudC5cclxuICpcclxuICogQHJldHVybiB7U29ja2V0fSBzZWxmXHJcbiAqIEBhcGkgcHVibGljXHJcbiAqL1xyXG5cclxuU29ja2V0LnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24oZXYpe1xyXG4gIGlmICh+ZXhwb3J0cy5ldmVudHMuaW5kZXhPZihldikpIHtcclxuICAgIGVtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuICB9IGVsc2Uge1xyXG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xyXG4gICAgdmFyIHBhY2tldCA9IHt9O1xyXG4gICAgcGFja2V0LnR5cGUgPSBoYXNCaW4oYXJncykgPyBwYXJzZXIuQklOQVJZX0VWRU5UIDogcGFyc2VyLkVWRU5UO1xyXG4gICAgcGFja2V0LmRhdGEgPSBhcmdzO1xyXG4gICAgdmFyIGZsYWdzID0gdGhpcy5mbGFncyB8fCB7fTtcclxuXHJcbiAgICAvLyBhY2Nlc3MgbGFzdCBhcmd1bWVudCB0byBzZWUgaWYgaXQncyBhbiBBQ0sgY2FsbGJhY2tcclxuICAgIGlmICgnZnVuY3Rpb24nID09IHR5cGVvZiBhcmdzW2FyZ3MubGVuZ3RoIC0gMV0pIHtcclxuICAgICAgaWYgKHRoaXMuX3Jvb21zIHx8IGZsYWdzLmJyb2FkY2FzdCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FsbGJhY2tzIGFyZSBub3Qgc3VwcG9ydGVkIHdoZW4gYnJvYWRjYXN0aW5nJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGRlYnVnKCdlbWl0dGluZyBwYWNrZXQgd2l0aCBhY2sgaWQgJWQnLCB0aGlzLm5zcC5pZHMpO1xyXG4gICAgICB0aGlzLmFja3NbdGhpcy5uc3AuaWRzXSA9IGFyZ3MucG9wKCk7XHJcbiAgICAgIHBhY2tldC5pZCA9IHRoaXMubnNwLmlkcysrO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLl9yb29tcyB8fCBmbGFncy5icm9hZGNhc3QpIHtcclxuICAgICAgdGhpcy5hZGFwdGVyLmJyb2FkY2FzdChwYWNrZXQsIHtcclxuICAgICAgICBleGNlcHQ6IFt0aGlzLmlkXSxcclxuICAgICAgICByb29tczogdGhpcy5fcm9vbXMsXHJcbiAgICAgICAgZmxhZ3M6IGZsYWdzXHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gZGlzcGF0Y2ggcGFja2V0XHJcbiAgICAgIHRoaXMucGFja2V0KHBhY2tldCwge1xyXG4gICAgICAgIHZvbGF0aWxlOiBmbGFncy52b2xhdGlsZSxcclxuICAgICAgICBjb21wcmVzczogZmxhZ3MuY29tcHJlc3NcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcmVzZXQgZmxhZ3NcclxuICAgIGRlbGV0ZSB0aGlzLl9yb29tcztcclxuICAgIGRlbGV0ZSB0aGlzLmZsYWdzO1xyXG4gIH1cclxuICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBUYXJnZXRzIGEgcm9vbSB3aGVuIGJyb2FkY2FzdGluZy5cclxuICpcclxuICogQHBhcmFtIHtTdHJpbmd9IG5hbWVcclxuICogQHJldHVybiB7U29ja2V0fSBzZWxmXHJcbiAqIEBhcGkgcHVibGljXHJcbiAqL1xyXG5cclxuU29ja2V0LnByb3RvdHlwZS50byA9XHJcblNvY2tldC5wcm90b3R5cGUuaW4gPSBmdW5jdGlvbihuYW1lKXtcclxuICB0aGlzLl9yb29tcyA9IHRoaXMuX3Jvb21zIHx8IFtdO1xyXG4gIGlmICghfnRoaXMuX3Jvb21zLmluZGV4T2YobmFtZSkpIHRoaXMuX3Jvb21zLnB1c2gobmFtZSk7XHJcbiAgcmV0dXJuIHRoaXM7XHJcbn07XHJcblxyXG4vKipcclxuICogU2VuZHMgYSBgbWVzc2FnZWAgZXZlbnQuXHJcbiAqXHJcbiAqIEByZXR1cm4ge1NvY2tldH0gc2VsZlxyXG4gKiBAYXBpIHB1YmxpY1xyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUuc2VuZCA9XHJcblNvY2tldC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbigpe1xyXG4gIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuICBhcmdzLnVuc2hpZnQoJ21lc3NhZ2UnKTtcclxuICB0aGlzLmVtaXQuYXBwbHkodGhpcywgYXJncyk7XHJcbiAgcmV0dXJuIHRoaXM7XHJcbn07XHJcblxyXG4vKipcclxuICogV3JpdGVzIGEgcGFja2V0LlxyXG4gKlxyXG4gKiBAcGFyYW0ge09iamVjdH0gcGFja2V0IG9iamVjdFxyXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0cyBvcHRpb25zXHJcbiAqIEBhcGkgcHJpdmF0ZVxyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUucGFja2V0ID0gZnVuY3Rpb24ocGFja2V0LCBvcHRzKXtcclxuICBwYWNrZXQubnNwID0gdGhpcy5uc3AubmFtZTtcclxuICBvcHRzID0gb3B0cyB8fCB7fTtcclxuICBvcHRzLmNvbXByZXNzID0gZmFsc2UgIT09IG9wdHMuY29tcHJlc3M7XHJcbiAgdGhpcy5jbGllbnQucGFja2V0KHBhY2tldCwgb3B0cyk7XHJcbn07XHJcblxyXG4vKipcclxuICogSm9pbnMgYSByb29tLlxyXG4gKlxyXG4gKiBAcGFyYW0ge1N0cmluZ30gcm9vbVxyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBvcHRpb25hbCwgY2FsbGJhY2tcclxuICogQHJldHVybiB7U29ja2V0fSBzZWxmXHJcbiAqIEBhcGkgcHJpdmF0ZVxyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUuam9pbiA9IGZ1bmN0aW9uKHJvb20sIGZuKXtcclxuICBkZWJ1Zygnam9pbmluZyByb29tICVzJywgcm9vbSk7XHJcbiAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gIGlmICh0aGlzLnJvb21zLmhhc093blByb3BlcnR5KHJvb20pKSB7XHJcbiAgICBmbiAmJiBmbihudWxsKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuICB0aGlzLmFkYXB0ZXIuYWRkKHRoaXMuaWQsIHJvb20sIGZ1bmN0aW9uKGVycil7XHJcbiAgICBpZiAoZXJyKSByZXR1cm4gZm4gJiYgZm4oZXJyKTtcclxuICAgIGRlYnVnKCdqb2luZWQgcm9vbSAlcycsIHJvb20pO1xyXG4gICAgc2VsZi5yb29tc1tyb29tXSA9IHJvb207XHJcbiAgICBmbiAmJiBmbihudWxsKTtcclxuICB9KTtcclxuICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBMZWF2ZXMgYSByb29tLlxyXG4gKlxyXG4gKiBAcGFyYW0ge1N0cmluZ30gcm9vbVxyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBvcHRpb25hbCwgY2FsbGJhY2tcclxuICogQHJldHVybiB7U29ja2V0fSBzZWxmXHJcbiAqIEBhcGkgcHJpdmF0ZVxyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUubGVhdmUgPSBmdW5jdGlvbihyb29tLCBmbil7XHJcbiAgZGVidWcoJ2xlYXZlIHJvb20gJXMnLCByb29tKTtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgdGhpcy5hZGFwdGVyLmRlbCh0aGlzLmlkLCByb29tLCBmdW5jdGlvbihlcnIpe1xyXG4gICAgaWYgKGVycikgcmV0dXJuIGZuICYmIGZuKGVycik7XHJcbiAgICBkZWJ1ZygnbGVmdCByb29tICVzJywgcm9vbSk7XHJcbiAgICBkZWxldGUgc2VsZi5yb29tc1tyb29tXTtcclxuICAgIGZuICYmIGZuKG51bGwpO1xyXG4gIH0pO1xyXG4gIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIExlYXZlIGFsbCByb29tcy5cclxuICpcclxuICogQGFwaSBwcml2YXRlXHJcbiAqL1xyXG5cclxuU29ja2V0LnByb3RvdHlwZS5sZWF2ZUFsbCA9IGZ1bmN0aW9uKCl7XHJcbiAgdGhpcy5hZGFwdGVyLmRlbEFsbCh0aGlzLmlkKTtcclxuICB0aGlzLnJvb21zID0ge307XHJcbn07XHJcblxyXG4vKipcclxuICogQ2FsbGVkIGJ5IGBOYW1lc3BhY2VgIHVwb24gc3VjY2Vzc2Z1bFxyXG4gKiBtaWRkbGV3YXJlIGV4ZWN1dGlvbiAoaWU6IGF1dGhvcml6YXRpb24pLlxyXG4gKlxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLm9uY29ubmVjdCA9IGZ1bmN0aW9uKCl7XHJcbiAgZGVidWcoJ3NvY2tldCBjb25uZWN0ZWQgLSB3cml0aW5nIHBhY2tldCcpO1xyXG4gIHRoaXMubnNwLmNvbm5lY3RlZFt0aGlzLmlkXSA9IHRoaXM7XHJcbiAgdGhpcy5qb2luKHRoaXMuaWQpO1xyXG4gIHRoaXMucGFja2V0KHsgdHlwZTogcGFyc2VyLkNPTk5FQ1QgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ2FsbGVkIHdpdGggZWFjaCBwYWNrZXQuIENhbGxlZCBieSBgQ2xpZW50YC5cclxuICpcclxuICogQHBhcmFtIHtPYmplY3R9IHBhY2tldFxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLm9ucGFja2V0ID0gZnVuY3Rpb24ocGFja2V0KXtcclxuICBkZWJ1ZygnZ290IHBhY2tldCAlaicsIHBhY2tldCk7XHJcbiAgc3dpdGNoIChwYWNrZXQudHlwZSkge1xyXG4gICAgY2FzZSBwYXJzZXIuRVZFTlQ6XHJcbiAgICAgIHRoaXMub25ldmVudChwYWNrZXQpO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIHBhcnNlci5CSU5BUllfRVZFTlQ6XHJcbiAgICAgIHRoaXMub25ldmVudChwYWNrZXQpO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIHBhcnNlci5BQ0s6XHJcbiAgICAgIHRoaXMub25hY2socGFja2V0KTtcclxuICAgICAgYnJlYWs7XHJcblxyXG4gICAgY2FzZSBwYXJzZXIuQklOQVJZX0FDSzpcclxuICAgICAgdGhpcy5vbmFjayhwYWNrZXQpO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIHBhcnNlci5ESVNDT05ORUNUOlxyXG4gICAgICB0aGlzLm9uZGlzY29ubmVjdCgpO1xyXG4gICAgICBicmVhaztcclxuXHJcbiAgICBjYXNlIHBhcnNlci5FUlJPUjpcclxuICAgICAgdGhpcy5lbWl0KCdlcnJvcicsIHBhY2tldC5kYXRhKTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogQ2FsbGVkIHVwb24gZXZlbnQgcGFja2V0LlxyXG4gKlxyXG4gKiBAcGFyYW0ge09iamVjdH0gcGFja2V0IG9iamVjdFxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLm9uZXZlbnQgPSBmdW5jdGlvbihwYWNrZXQpe1xyXG4gIHZhciBhcmdzID0gcGFja2V0LmRhdGEgfHwgW107XHJcbiAgZGVidWcoJ2VtaXR0aW5nIGV2ZW50ICVqJywgYXJncyk7XHJcblxyXG4gIGlmIChudWxsICE9IHBhY2tldC5pZCkge1xyXG4gICAgZGVidWcoJ2F0dGFjaGluZyBhY2sgY2FsbGJhY2sgdG8gZXZlbnQnKTtcclxuICAgIGFyZ3MucHVzaCh0aGlzLmFjayhwYWNrZXQuaWQpKTtcclxuICB9XHJcblxyXG4gIHRoaXMuZGlzcGF0Y2goYXJncyk7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvZHVjZXMgYW4gYWNrIGNhbGxiYWNrIHRvIGVtaXQgd2l0aCBhbiBldmVudC5cclxuICpcclxuICogQHBhcmFtIHtOdW1iZXJ9IGlkIHBhY2tldCBpZFxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLmFjayA9IGZ1bmN0aW9uKGlkKXtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgdmFyIHNlbnQgPSBmYWxzZTtcclxuICByZXR1cm4gZnVuY3Rpb24oKXtcclxuICAgIC8vIHByZXZlbnQgZG91YmxlIGNhbGxiYWNrc1xyXG4gICAgaWYgKHNlbnQpIHJldHVybjtcclxuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcclxuICAgIGRlYnVnKCdzZW5kaW5nIGFjayAlaicsIGFyZ3MpO1xyXG5cclxuICAgIHZhciB0eXBlID0gaGFzQmluKGFyZ3MpID8gcGFyc2VyLkJJTkFSWV9BQ0sgOiBwYXJzZXIuQUNLO1xyXG4gICAgc2VsZi5wYWNrZXQoe1xyXG4gICAgICBpZDogaWQsXHJcbiAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgIGRhdGE6IGFyZ3NcclxuICAgIH0pO1xyXG5cclxuICAgIHNlbnQgPSB0cnVlO1xyXG4gIH07XHJcbn07XHJcblxyXG4vKipcclxuICogQ2FsbGVkIHVwb24gYWNrIHBhY2tldC5cclxuICpcclxuICogQGFwaSBwcml2YXRlXHJcbiAqL1xyXG5cclxuU29ja2V0LnByb3RvdHlwZS5vbmFjayA9IGZ1bmN0aW9uKHBhY2tldCl7XHJcbiAgdmFyIGFjayA9IHRoaXMuYWNrc1twYWNrZXQuaWRdO1xyXG4gIGlmICgnZnVuY3Rpb24nID09IHR5cGVvZiBhY2spIHtcclxuICAgIGRlYnVnKCdjYWxsaW5nIGFjayAlcyB3aXRoICVqJywgcGFja2V0LmlkLCBwYWNrZXQuZGF0YSk7XHJcbiAgICBhY2suYXBwbHkodGhpcywgcGFja2V0LmRhdGEpO1xyXG4gICAgZGVsZXRlIHRoaXMuYWNrc1twYWNrZXQuaWRdO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBkZWJ1ZygnYmFkIGFjayAlcycsIHBhY2tldC5pZCk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENhbGxlZCB1cG9uIGNsaWVudCBkaXNjb25uZWN0IHBhY2tldC5cclxuICpcclxuICogQGFwaSBwcml2YXRlXHJcbiAqL1xyXG5cclxuU29ja2V0LnByb3RvdHlwZS5vbmRpc2Nvbm5lY3QgPSBmdW5jdGlvbigpe1xyXG4gIGRlYnVnKCdnb3QgZGlzY29ubmVjdCBwYWNrZXQnKTtcclxuICB0aGlzLm9uY2xvc2UoJ2NsaWVudCBuYW1lc3BhY2UgZGlzY29ubmVjdCcpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEhhbmRsZXMgYSBjbGllbnQgZXJyb3IuXHJcbiAqXHJcbiAqIEBhcGkgcHJpdmF0ZVxyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUub25lcnJvciA9IGZ1bmN0aW9uKGVycil7XHJcbiAgaWYgKHRoaXMubGlzdGVuZXJzKCdlcnJvcicpLmxlbmd0aCkge1xyXG4gICAgdGhpcy5lbWl0KCdlcnJvcicsIGVycik7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ01pc3NpbmcgZXJyb3IgaGFuZGxlciBvbiBgc29ja2V0YC4nKTtcclxuICAgIGNvbnNvbGUuZXJyb3IoZXJyLnN0YWNrKTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogQ2FsbGVkIHVwb24gY2xvc2luZy4gQ2FsbGVkIGJ5IGBDbGllbnRgLlxyXG4gKlxyXG4gKiBAcGFyYW0ge1N0cmluZ30gcmVhc29uXHJcbiAqIEB0aHJvdyB7RXJyb3J9IG9wdGlvbmFsIGVycm9yIG9iamVjdFxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLm9uY2xvc2UgPSBmdW5jdGlvbihyZWFzb24pe1xyXG4gIGlmICghdGhpcy5jb25uZWN0ZWQpIHJldHVybiB0aGlzO1xyXG4gIGRlYnVnKCdjbG9zaW5nIHNvY2tldCAtIHJlYXNvbiAlcycsIHJlYXNvbik7XHJcbiAgdGhpcy5lbWl0KCdkaXNjb25uZWN0aW5nJywgcmVhc29uKTtcclxuICB0aGlzLmxlYXZlQWxsKCk7XHJcbiAgdGhpcy5uc3AucmVtb3ZlKHRoaXMpO1xyXG4gIHRoaXMuY2xpZW50LnJlbW92ZSh0aGlzKTtcclxuICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlO1xyXG4gIHRoaXMuZGlzY29ubmVjdGVkID0gdHJ1ZTtcclxuICBkZWxldGUgdGhpcy5uc3AuY29ubmVjdGVkW3RoaXMuaWRdO1xyXG4gIHRoaXMuZW1pdCgnZGlzY29ubmVjdCcsIHJlYXNvbik7XHJcbn07XHJcblxyXG4vKipcclxuICogUHJvZHVjZXMgYW4gYGVycm9yYCBwYWNrZXQuXHJcbiAqXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBlcnIgZXJyb3Igb2JqZWN0XHJcbiAqIEBhcGkgcHJpdmF0ZVxyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbihlcnIpe1xyXG4gIHRoaXMucGFja2V0KHsgdHlwZTogcGFyc2VyLkVSUk9SLCBkYXRhOiBlcnIgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogRGlzY29ubmVjdHMgdGhpcyBjbGllbnQuXHJcbiAqXHJcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gY2xvc2UgaWYgYHRydWVgLCBjbG9zZXMgdGhlIHVuZGVybHlpbmcgY29ubmVjdGlvblxyXG4gKiBAcmV0dXJuIHtTb2NrZXR9IHNlbGZcclxuICogQGFwaSBwdWJsaWNcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLmRpc2Nvbm5lY3QgPSBmdW5jdGlvbihjbG9zZSl7XHJcbiAgaWYgKCF0aGlzLmNvbm5lY3RlZCkgcmV0dXJuIHRoaXM7XHJcbiAgaWYgKGNsb3NlKSB7XHJcbiAgICB0aGlzLmNsaWVudC5kaXNjb25uZWN0KCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHRoaXMucGFja2V0KHsgdHlwZTogcGFyc2VyLkRJU0NPTk5FQ1QgfSk7XHJcbiAgICB0aGlzLm9uY2xvc2UoJ3NlcnZlciBuYW1lc3BhY2UgZGlzY29ubmVjdCcpO1xyXG4gIH1cclxuICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbi8qKlxyXG4gKiBTZXRzIHRoZSBjb21wcmVzcyBmbGFnLlxyXG4gKlxyXG4gKiBAcGFyYW0ge0Jvb2xlYW59IGNvbXByZXNzIGlmIGB0cnVlYCwgY29tcHJlc3NlcyB0aGUgc2VuZGluZyBkYXRhXHJcbiAqIEByZXR1cm4ge1NvY2tldH0gc2VsZlxyXG4gKiBAYXBpIHB1YmxpY1xyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUuY29tcHJlc3MgPSBmdW5jdGlvbihjb21wcmVzcyl7XHJcbiAgdGhpcy5mbGFncyA9IHRoaXMuZmxhZ3MgfHwge307XHJcbiAgdGhpcy5mbGFncy5jb21wcmVzcyA9IGNvbXByZXNzO1xyXG4gIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIERpc3BhdGNoIGluY29taW5nIGV2ZW50IHRvIHNvY2tldCBsaXN0ZW5lcnMuXHJcbiAqXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGV2ZW50IHRoYXQgd2lsbCBnZXQgZW1pdHRlZFxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblxyXG5Tb2NrZXQucHJvdG90eXBlLmRpc3BhdGNoID0gZnVuY3Rpb24oZXZlbnQpe1xyXG4gIGRlYnVnKCdkaXNwYXRjaGluZyBhbiBldmVudCAlaicsIGV2ZW50KTtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgdGhpcy5ydW4oZXZlbnQsIGZ1bmN0aW9uKGVycil7XHJcbiAgICBwcm9jZXNzLm5leHRUaWNrKGZ1bmN0aW9uKCl7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICByZXR1cm4gc2VsZi5lbWl0KCdlcnJvcicsIGVyci5kYXRhIHx8IGVyci5tZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgICBlbWl0LmFwcGx5KHNlbGYsIGV2ZW50KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0cyB1cCBzb2NrZXQgbWlkZGxld2FyZS5cclxuICpcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gbWlkZGxld2FyZSBmdW5jdGlvbiAoZXZlbnQsIG5leHQpXHJcbiAqIEByZXR1cm4ge1NvY2tldH0gc2VsZlxyXG4gKiBAYXBpIHB1YmxpY1xyXG4gKi9cclxuXHJcblNvY2tldC5wcm90b3R5cGUudXNlID0gZnVuY3Rpb24oZm4pe1xyXG4gIHRoaXMuZm5zLnB1c2goZm4pO1xyXG4gIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEV4ZWN1dGVzIHRoZSBtaWRkbGV3YXJlIGZvciBhbiBpbmNvbWluZyBldmVudC5cclxuICpcclxuICogQHBhcmFtIHtBcnJheX0gZXZlbnQgdGhhdCB3aWxsIGdldCBlbWl0dGVkXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGxhc3QgZm4gY2FsbCBpbiB0aGUgbWlkZGxld2FyZVxyXG4gKiBAYXBpIHByaXZhdGVcclxuICovXHJcblNvY2tldC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oZXZlbnQsIGZuKXtcclxuICB2YXIgZm5zID0gdGhpcy5mbnMuc2xpY2UoMCk7XHJcbiAgaWYgKCFmbnMubGVuZ3RoKSByZXR1cm4gZm4obnVsbCk7XHJcblxyXG4gIGZ1bmN0aW9uIHJ1bihpKXtcclxuICAgIGZuc1tpXShldmVudCwgZnVuY3Rpb24oZXJyKXtcclxuICAgICAgLy8gdXBvbiBlcnJvciwgc2hvcnQtY2lyY3VpdFxyXG4gICAgICBpZiAoZXJyKSByZXR1cm4gZm4oZXJyKTtcclxuXHJcbiAgICAgIC8vIGlmIG5vIG1pZGRsZXdhcmUgbGVmdCwgc3VtbW9uIGNhbGxiYWNrXHJcbiAgICAgIGlmICghZm5zW2kgKyAxXSkgcmV0dXJuIGZuKG51bGwpO1xyXG5cclxuICAgICAgLy8gZ28gb24gdG8gbmV4dFxyXG4gICAgICBydW4oaSArIDEpO1xyXG4gICAgfSk7IFxyXG4gIH1cclxuXHJcbiAgcnVuKDApO1xyXG59OyAiLCJ2YXIgc29ja2V0ID0gaW8oKTsiXX0=
